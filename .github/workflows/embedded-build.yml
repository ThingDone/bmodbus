name: Embedded Build
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  arduino_builds:
    #strategy:
    #  matrix:
    #    board: [ "adafruit:samd:adafruit_feather_m4" ]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Copy required files
        run: |
            ls -l
            cp ./tests/client/test_bmodbus_client.c ./tests/arduino/arduino_client_example/test_bmodbus_client.c
            cp ./tests/unity/unity.c ./tests/arduino/arduino_client_example/unity.c
            cp ./tests/unity/unity.h ./tests/arduino/arduino_client_example/unity.h
            cp ./tests/unity/unity_internals.h ./tests/arduino/arduino_client_example/unity_internals.h
            cp ./bmodbus/bmodbus.h ./tests/arduino/arduino_client_example/bmodbus.h
            cp ./bmodbus/bmodbus.c ./tests/arduino/arduino_client_example/bmodbus.c
      - name: Compile Sketch
        uses: arduino/compile-sketches@v1.1.2
        with:
          sketch-paths: |
            - ./tests/arduino/arduino_client_example
          fqbn: "adafruit:samd:adafruit_feather_m4"
          platforms: | 
            - name "adafruit:samd"
            - source-url "https://adafruit.github.io/arduino-board-index/package_adafruit_index.json"
          verbose: 'true'
